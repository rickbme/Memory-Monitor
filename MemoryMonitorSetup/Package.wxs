<?xml version="1.0" encoding="utf-8"?>
<!-- 
  Memory Monitor Installer Package (WiX v5)
  
  IMPORTANT VERSION NOTES:
  - UpgradeCode MUST remain stable across all versions (DO NOT CHANGE)
  - Version should be updated for each release (currently 2.4.1.0)
  - MajorUpgrade automatically removes older versions
-->
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Package Name="Memory Monitor" 
           Manufacturer="DFS" 
           Version="2.4.1.0" 
           UpgradeCode="D9A1E6B2-1234-4F56-9A2B-ABCDEF012345"
           Compressed="yes"
           InstallerVersion="500">
    
    <!-- Automatically remove older installed major versions -->
    <MajorUpgrade 
      DowngradeErrorMessage="A newer version of Memory Monitor is already installed. Please uninstall the newer version before installing this version." />
    
    <!-- Embed CAB file inside MSI -->
    <MediaTemplate EmbedCab="yes" />
    
    <!-- Directory structure -->
    <StandardDirectory Id="ProgramFiles6432Folder">
      <Directory Id="INSTALLFOLDER" Name="Memory Monitor" />
    </StandardDirectory>
    
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="Memory Monitor" />
    </StandardDirectory>
    
    <StandardDirectory Id="DesktopFolder" />
    
    <!-- Main feature - includes all application files and shortcuts -->
    <Feature Id="Main" Title="Memory Monitor" Level="1">
      <!-- Root-level published files -->
      <ComponentGroupRef Id="PublishedFileComponents" />
      
      <!-- Language/resource subdirectories (auto-generated by Regenerate-PublishedFiles.ps1) -->
      <ComponentGroupRef Id="csComponents" />
      <ComponentGroupRef Id="deComponents" />
      <ComponentGroupRef Id="esComponents" />
      <ComponentGroupRef Id="frComponents" />
      <ComponentGroupRef Id="itComponents" />
      <ComponentGroupRef Id="jaComponents" />
      <ComponentGroupRef Id="koComponents" />
      <ComponentGroupRef Id="plComponents" />
      <ComponentGroupRef Id="pt_BRComponents" />
      <ComponentGroupRef Id="ResourcesComponents" />
      <ComponentGroupRef Id="ruComponents" />
      <ComponentGroupRef Id="trComponents" />
      <ComponentGroupRef Id="zh_HansComponents" />
      <ComponentGroupRef Id="zh_HantComponents" />
      
      <!-- Shortcuts -->
      <ComponentGroupRef Id="StartMenuShortcuts" />
      <ComponentGroupRef Id="DesktopShortcuts" />
      <ComponentGroupRef Id="UserGuide" />
    </Feature>
    
    <!-- Add/Remove Programs configuration -->
    <Icon Id="AppIcon.exe" SourceFile="..\Memory Monitor\bin\Release\net8.0-windows\win-x64\publish\Memory Monitor.exe" />
    <Property Id="ARPPRODUCTICON" Value="AppIcon.exe" />
    <Property Id="ARPHELPLINK" Value="https://github.com/rickbme/Memory-Monitor" />
    <Property Id="ARPNOREPAIR" Value="yes" Secure="yes" />
    <Property Id="ARPNOMODIFY" Value="yes" Secure="yes" />
    
  </Package>
  
  <!-- Start Menu Shortcuts -->
  <Fragment>
    <ComponentGroup Id="StartMenuShortcuts" Directory="ApplicationProgramsFolder">
      <Component Id="StartMenuShortcut" Guid="78901234-0123-4321-0123-78901234ABCD">
        <Shortcut Id="ApplicationStartMenuShortcut"
                  Name="Memory Monitor"
                  Description="System Resource Monitor for Mini Displays"
                  Target="[INSTALLFOLDER]Memory Monitor.exe"
                  WorkingDirectory="INSTALLFOLDER"
                  Icon="AppIcon.exe" />
        
        <!-- User Guide shortcut in Start Menu -->
        <Shortcut Id="UserGuideStartMenuShortcut"
                  Name="Memory Monitor User Guide"
                  Description="View the Memory Monitor User Guide"
                  Target="[INSTALLFOLDER]USER_GUIDE.md"
                  WorkingDirectory="INSTALLFOLDER" />
        
        <RemoveFolder Id="CleanUpStartMenu" Directory="ApplicationProgramsFolder" On="uninstall" />
        <RegistryValue Root="HKCU" 
                       Key="Software\MemoryMonitor" 
                       Name="installed" 
                       Type="integer" 
                       Value="1" 
                       KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>
  
  <!-- Desktop Shortcuts -->
  <Fragment>
    <ComponentGroup Id="DesktopShortcuts" Directory="DesktopFolder">
      <Component Id="DesktopShortcut" Guid="89012345-1234-5432-1234-89012345BCDE">
        <Shortcut Id="ApplicationDesktopShortcut"
                  Name="Memory Monitor"
                  Description="System Resource Monitor for Mini Displays"
                  Target="[INSTALLFOLDER]Memory Monitor.exe"
                  WorkingDirectory="INSTALLFOLDER"
                  Icon="AppIcon.exe" />
        <RegistryValue Root="HKCU" 
                       Key="Software\MemoryMonitor" 
                       Name="desktopShortcut" 
                       Type="integer" 
                       Value="1" 
                       KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>
  
  <!-- User Guide Component -->
  <Fragment>
    <ComponentGroup Id="UserGuide" Directory="INSTALLFOLDER">
      <Component Id="UserGuideFile" Guid="90123456-2345-6543-2345-90123456CDEF">
        <File Id="UserGuideMarkdown" 
              Source="..\USER_GUIDE.md" 
              KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>